{% load role_tags %}
{% load static %}
<div id="sidebar" class="w-full h-full bg-white border-r border-gray-200 flex flex-col overflow-hidden">

    <!-- Logo Section -->
    <div class="hidden lg:flex items-center justify-between p-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50">
    <div class="flex items-center space-x-3">
        <div class="relative">
            <img src="/static/img/powermason_logo.png" alt="Powermason Logo" class="h-10 w-10 rounded-lg shadow-sm border border-gray-200">
        </div>
        <div>
            <h1 class="text-xl font-bold text-gray-800">Powermason</h1>
        </div>
    </div>
</div>

    {% if user.is_authenticated %}
    {% if user.is_superuser or user|has_role:"PM,EG,OM,VO" %}
    <!-- User Profile Section -->
    <div class="p-4 border-b border-gray-100">
        <div class="flex items-center p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl hover:from-blue-100 hover:to-indigo-100 transition-all duration-200 space-x-3 border border-blue-100">
            <a href="{% url 'profile' %}" class="flex items-center space-x-3 group">
    <div class="relative">
        {% if user.userprofile.avatar %}
            <img src="{{ user.userprofile.avatar.url }}" alt="Profile" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-sm">
        {% else %}
            <img src="{% static 'img/default-avatar.jpg' %}" alt="Profile" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-sm">
        {% endif %}
        <div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 rounded-full border-2 border-white"></div>
    </div>
    <div class="flex-1 min-w-0">
        <p class="text-xs text-gray-500 uppercase tracking-wide">Welcome Back</p>
        <p class="text-gray-900 font-semibold truncate">
            {% if user.first_name %}
                {{ user.first_name }} {{ user.last_name }}
            {% else %}
                {{ user.email|cut:"@gmail.com" }}
            {% endif %}
        </p>
        <p class="text-xs text-gray-500">
            {% if user.is_superuser %}
                System Administrator
            {% elif user|has_role:"OM" %}
                Operations Manager
            {% elif user|has_role:"EG" %}
                Engineer
            {% elif user|has_role:"PM" %}
                Project Manager
            {% elif user|has_role:"VO" %}
                View Only
            {% else %}
                No profile information available.
            {% endif %}
        </p>
    </div>
    {% endif %}
    {% endif %}
</a>

            
            <!-- Notification Bell -->
<div class="relative flex-shrink-0">
    <button id="notifToggle" class="relative p-2 rounded-lg hover:bg-blue-100 transition-colors group">
        <svg class="h-5 w-5 text-gray-500 group-hover:text-blue-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
        </svg>
        <!-- Badge will be added dynamically by JS -->
    </button>

    <!-- Notification Dropdown -->
    <div id="notifDropdown" class="hidden absolute right-0 top-12 w-80 max-h-96 bg-white shadow-xl rounded-xl border border-gray-200 z-50 overflow-hidden">
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-4 text-white">
            <div class="flex items-center justify-between">
                <h3 class="font-semibold text-lg">Notifications</h3>
                <div class="flex space-x-2">
                    <button id="markAllReadBtn" class="text-xs bg-white/20 hover:bg-white/30 px-3 py-1 rounded-md transition-colors">
                        Mark all read
                    </button>
                    <button id="clearAllBtn" class="text-xs bg-red-500/20 hover:bg-red-500/30 px-3 py-1 rounded-md transition-colors">
                        Clear all
                    </button>
                </div>
            </div>
        </div>
        <div id="notificationContent" class="max-h-80 overflow-y-auto">
            <!-- Notifications will be loaded here via AJAX -->
            <div class="text-center py-8 text-gray-500">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                <p class="mt-2 text-sm">Loading notifications...</p>
            </div>
        </div>
    </div>
</div>
        </div>
    </div>
    
    <!-- Navigation Menu -->
    <nav class="flex-1 p-4 overflow-y-auto">
        <div class="space-y-2">
            
            <!-- Dashboard -->
            <div class="sidebar-menu-item">
                <a href="/" class="group flex items-center p-3 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 ">
                    <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-blue-100 transition-colors ">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                        </svg>
                    </div>
                    <span class="font-medium">Dashboard</span>
                </a>
            </div>

            <!-- Project Management -->
            {% if user|has_role:"PM,VO" or user.is_superuser or user|has_role:"EG,OM" %}
            <div class="sidebar-menu-item">
                <!-- EG/OM: Dropdown -->
                
                <button type="button" class="group flex items-center p-3 text-gray-700 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-all duration-200 w-full " onclick="toggleSubmenu('projectProfilingSubmenu','projectProfilingArrow')">
                    <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-purple-100 transition-colors ">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                        </svg>
                    </div>
                    <span class="flex-1 font-medium text-left">Project Management</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-2 transition-transform duration-200" id="projectProfilingArrow" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>
               

                <!-- Submenu -->
                <div id="projectProfilingSubmenu" class="ml-6 mt-2 hidden space-y-1 border-l-2 border-purple-200 pl-4">
                     {% if user|has_role:"PM, VO" %}
                <a href="{% url 'project_list_default' %}" title="View Projects" class="group flex items-center p-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200 ">
                        <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-indigo-100 transition-colors ">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                        <span class="text-sm font-medium">Project List</span>
                    </a>
                    {% else %}
                    <!-- Client Management -->
                    <a href="{% url 'client_management' %}" class="group flex items-center p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200 ">
                        <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-green-100 transition-colors ">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                        </div>
                        <span class="text-sm font-medium">Client Management</span>
                    </a>

                    <a href="{% url 'pending_projects_list' %}" class="group flex items-center p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200">
    <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-green-100 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
    </div>
    <span class="text-sm font-medium">Pending Projects</span>
</a>
<a href="{% url 'draft_projects_list' %}" class="group flex items-center p-2 text-gray-600 hover:text-amber-600 hover:bg-amber-50 rounded-lg transition-all duration-200">
    <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-amber-100 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
    </div>
    <span class="text-sm font-medium">Draft Projects</span>
</a>

                    <!-- General Contractor -->
                    <a href="{% url 'project_list_general_contractor_session' %}" title="View General Contractor Projects" class="group flex items-center p-2 text-gray-600 hover:text-orange-600 hover:bg-orange-50 rounded-lg transition-all duration-200 ">
                        <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-orange-100 transition-colors ">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                            </svg>
                        </div>
                        <span class="text-sm font-medium">General Contractor</span>
                    </a>

                    <!-- Direct Client -->
                    <a href="{% url 'project_list_direct_client_session' %}" title="View Direct Client Projects" class="group flex items-center p-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200 ">
                        <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-indigo-100 transition-colors ">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                        <span class="text-sm font-medium">Direct Client</span>
                    </a>
                    
                    
                </div>
                {% endif %}
                {% endif %}           

                
            </div>
            

            <!-- Progress Monitoring -->
            <div class="sidebar-menu-item">
                <a href="{% if token and role %}{% url 'progress_monitoring' token role %}{% else %}#{% endif %}" class="group flex items-center p-3 text-gray-700 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-all duration-200 ">
                    <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-emerald-100 transition-colors ">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                        </svg>
                    </div>
                    <span class="font-medium">Progress Monitoring</span>
                </a>
            </div>

            <!-- Materials & Equipment -->
            <div class="sidebar-menu-item">
                <button type="button" class="group flex items-center p-3 text-gray-700 hover:text-amber-600 hover:bg-amber-50 rounded-lg transition-all duration-200 w-full" onclick="toggleSubmenu('materialsSubmenu','materialsArrow')">
                    <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-amber-100 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                        </svg>
                    </div>
                    <span class="flex-1 font-medium text-left">Materials & Equipment</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-2 transition-transform duration-200" id="materialsArrow" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>

                <!-- Submenu -->
                <div id="materialsSubmenu" class="ml-6 mt-2 hidden space-y-1 border-l-2 border-amber-200 pl-4">
                    <a href="{% url 'materials_equipment:material_list' %}" class="group flex items-center p-2 text-gray-600 hover:text-amber-600 hover:bg-amber-50 rounded-lg transition-all duration-200">
                        <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-amber-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                            </svg>
                        </div>
                        <span class="text-sm font-medium">Materials</span>
                    </a>

                    <a href="{% url 'materials_equipment:equipment_list' %}" class="group flex items-center p-2 text-gray-600 hover:text-amber-600 hover:bg-amber-50 rounded-lg transition-all duration-200">
                        <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-amber-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                            </svg>
                        </div>
                        <span class="text-sm font-medium">Equipment</span>
                    </a>

                    <a href="{% url 'materials_equipment:price_monitoring' %}" class="group flex items-center p-2 text-gray-600 hover:text-amber-600 hover:bg-amber-50 rounded-lg transition-all duration-200">
                        <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-amber-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                        </div>
                        <span class="text-sm font-medium">Price Monitoring</span>
                    </a>
                </div>
            </div>

            <!-- Cost Tracking -->
            {% if user.is_superuser or user|has_role:"EG,OM" %}
            <div class="sidebar-menu-item">
                <button type="button" class="group flex items-center p-3 text-gray-700 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200 w-full" onclick="toggleSubmenu('costTrackingSubmenu','costTrackingArrow')">
                    <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-green-100 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <span class="flex-1 font-medium text-left">Cost Tracking</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-2 transition-transform duration-200" id="costTrackingArrow" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>

                <!-- Submenu -->
                <div id="costTrackingSubmenu" class="ml-6 mt-2 hidden space-y-1 border-l-2 border-green-200 pl-4">
                    <a href="{% if token and role %}{% url 'project_costing_dashboard' token role %}{% else %}#{% endif %}" class="group flex items-center p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200">
                        <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-green-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <span class="text-sm font-medium">Cost Dashboard</span>
                    </a>

                    <a href="{% url 'subcontractor_list' %}" class="group flex items-center p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200">
                        <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-green-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                        </div>
                        <span class="text-sm font-medium">Subcontractors</span>
                    </a>

                    <a href="{% if token and role %}{% url 'mobilization_costs' token role %}{% else %}#{% endif %}" class="group flex items-center p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200">
                        <div class="flex items-center justify-center w-6 h-6 mr-2 rounded bg-gray-100 group-hover:bg-green-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                        </div>
                        <span class="text-sm font-medium">Mobilization Costs</span>
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- Document Library -->
            <div class="sidebar-menu-item">
                <a href="{% url 'document_library' %}" class="group flex items-center p-3 text-gray-700 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200">
                    <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-indigo-100 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                    <span class="font-medium">Document Library</span>
                </a>
            </div>

            <!-- {% if user.is_superuser or user|has_role:"EG,OM" %}
            Project Costing
            <div class="sidebar-menu-item">
                <a href="{% url 'project_costing_dashboard' token role%}" class="group flex items-center p-3 text-gray-700 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 ">
                    <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-yellow-100 transition-colors ">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <span class="font-medium">Project Costing</span>
                </a>
            </div>
            {% endif %} -->
            
            
            

            {% if user.is_superuser or user|has_role:"EG,OM" %}
            <!-- Tracking & Analytics Section -->
            <div class="pt-4 mt-4 border-t border-gray-200">
                <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3 px-3">Tracking & Analytics</h4>
                
                <!-- Budget Tracking -->
                <div class="sidebar-menu-item">
                    <a href="#" class="group flex items-center p-3 text-gray-700 hover:text-teal-600 hover:bg-teal-50 rounded-lg transition-all duration-200">
                        <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-teal-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <span class="font-medium">Budget Tracking</span>
                        
                    </a>
                </div>

                <!-- Resource Management -->
                <div class="sidebar-menu-item">
                    <a href="#" class="group flex items-center p-3 text-gray-700 hover:text-cyan-600 hover:bg-cyan-50 rounded-lg transition-all duration-200">
                        <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-cyan-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                        </div>
                        <span class="font-medium">Resource Management</span>
                    </a>
                </div>

                <!-- Timeline Tracker -->
                <div class="sidebar-menu-item">
                    <a href="#" class="group flex items-center p-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-all duration-200">
                        <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-pink-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <span class="font-medium">Timeline Tracker</span>
                    </a>
                </div>

                <!-- Cost Analytics -->
                <div class="sidebar-menu-item">
                    <a href="#" class="group flex items-center p-3 text-gray-700 hover:text-violet-600 hover:bg-violet-50 rounded-lg transition-all duration-200">
                        <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-violet-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <span class="font-medium">Cost Analytics</span>
                    </a>
                </div>
            </div>

            <!-- Reports -->
            <div class="sidebar-menu-item">
                <a href="#" class="group flex items-center p-3 text-gray-700 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 ">
                    <div class="flex items-center justify-center w-8 h-8 mr-3 rounded-lg bg-gray-100 group-hover:bg-red-100 transition-colors ">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                    <span class="font-medium">Reports</span>
                </a>
            </div>
            {% endif %}
        </div>
    </nav>
    
    <!-- Footer Actions -->
    <div class="border-t border-gray-200 bg-gray-50 p-4">
        <div class="space-y-2">
            {% if user.is_superuser or user|has_role:"EG,OM" %}
            <a href="{% url 'manage_user_profiles_session' %}"
   class="group flex items-center p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200">
    <div class="flex items-center justify-center w-6 h-6 mr-3 rounded bg-gray-200 group-hover:bg-blue-100 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg"
             class="h-3 w-3 text-gray-500"
             fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87M12 12a4 4 0 100-8 4 4 0 000 8z" />
        </svg>
    </div>
    <span class="text-sm font-medium">Manage Users</span>
</a>
<a href="{% url 'employee:dashboard' %}"
   class="group flex items-center p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200">
    <div class="flex items-center justify-center w-6 h-6 mr-3 rounded bg-gray-200 group-hover:bg-green-100 transition-colors">
       <svg xmlns="http://www.w3.org/2000/svg" 
     class="h-3 w-3" 
     fill="none" 
     viewBox="0 0 24 24" 
     stroke="currentColor" 
     stroke-width="2" 
     stroke-linecap="round" 
     stroke-linejoin="round">

  <!-- Person 1 -->
  <circle cx="7" cy="7" r="2"/>
  <path d="M3 21v-2a4 4 0 0 1 8 0v2"/>

  <!-- Person 2 -->
  <circle cx="12" cy="7" r="2"/>
  <path d="M8 21v-2a4 4 0 0 1 8 0v2"/>

  <!-- Person 3 -->
  <circle cx="17" cy="7" r="2"/>
  <path d="M13 21v-2a4 4 0 0 1 8 0v2"/>
</svg>

    </div>
    <span class="text-sm font-medium">Manage Employees</span>
</a>

{% endif %}

            

            <!-- Settings -->
            <a href="{% url 'settings' %}" class="group flex items-center p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200">
                <div class="flex items-center justify-center w-6 h-6 mr-3 rounded bg-gray-200 group-hover:bg-gray-300 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.517-.877 3.296.902 2.419 2.419a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.877 1.517-.902 3.296-2.419 2.419a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.517.877-3.296-.902-2.419-2.419a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.877-1.517.902-3.296 2.419-2.419.9.52 2.057.184 2.573-1.066z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </div>
                <span class="text-sm font-medium">Settings</span>
            </a>

            <!-- Logout -->
            <a href="{% url 'account_logout' %}" class="group flex items-center p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200">
                <div class="flex items-center justify-center w-6 h-6 mr-3 rounded bg-gray-200 group-hover:bg-red-100 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                </div>
                <span class="text-sm font-medium">Logout</span>
            </a>
        </div>

        <!-- System Status -->
        <div class="mt-4 pt-3 border-t border-gray-200">
            <div class="flex items-center justify-between text-xs text-gray-500">
                <span class="font-medium">{{ APP_VERSION }}</span>
                <div class="flex items-center space-x-1">
                    <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                    <span>System Offline</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Enhanced Functionality -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const toggle = document.getElementById("notifToggle");
    const dropdown = document.getElementById("notifDropdown");

    if (toggle && dropdown) {
        dropdown.style.display = 'none';
        
        toggle.addEventListener("click", function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (dropdown.style.display === 'none') {
                // Get button position
                const toggleRect = toggle.getBoundingClientRect();
                
                // Position dropdown to overlap main content area
                dropdown.style.display = 'block';
                dropdown.style.position = 'fixed';
                dropdown.style.top = (toggleRect.top - 5) + 'px';
                dropdown.style.left = '280px'; // Just outside the sidebar (264px + 16px margin)
                dropdown.style.width = '360px'; // Wider for better UX
                dropdown.style.maxHeight = '450px';
                dropdown.style.zIndex = '9999';
                
                // Ensure it doesn't overflow right edge of viewport
                if (280 + 360 > window.innerWidth) {
                    dropdown.style.left = (window.innerWidth - 370) + 'px';
                }
                
                // Ensure it doesn't overflow bottom of viewport
                const maxHeight = window.innerHeight - toggleRect.bottom - 20;
                if (maxHeight < 450) {
                    dropdown.style.maxHeight = maxHeight + 'px';
                }
                
                // Add backdrop shadow
                dropdown.style.boxShadow = '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)';
                dropdown.style.border = '1px solid #e5e7eb';
                dropdown.style.borderRadius = '12px';
                
                // Smooth animation
                dropdown.style.opacity = '0';
                dropdown.style.transform = 'translateY(-12px) scale(0.95)';
                dropdown.style.transition = 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)';
                
                requestAnimationFrame(() => {
                    dropdown.style.opacity = '1';
                    dropdown.style.transform = 'translateY(0) scale(1)';
                });
                
            } else {
                // Fade out animation
                dropdown.style.opacity = '0';
                dropdown.style.transform = 'translateY(-12px) scale(0.95)';
                setTimeout(() => {
                    dropdown.style.display = 'none';
                }, 200);
            }
        });

        // Close on outside click
        document.addEventListener("click", function(e) {
            if (!dropdown.contains(e.target) && !toggle.contains(e.target)) {
                if (dropdown.style.display !== 'none') {
                    dropdown.style.opacity = '0';
                    dropdown.style.transform = 'translateY(-12px) scale(0.95)';
                    setTimeout(() => {
                        dropdown.style.display = 'none';
                    }, 200);
                }
            }
        });

        dropdown.addEventListener('click', function(e) {
            e.stopPropagation();
        });

        // Close on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && dropdown.style.display !== 'none') {
                dropdown.style.opacity = '0';
                dropdown.style.transform = 'translateY(-12px) scale(0.95)';
                setTimeout(() => {
                    dropdown.style.display = 'none';
                }, 200);
            }
        });
    }

    // Submenu Toggle Functionality
    window.toggleSubmenu = function(submenuId, arrowId) {
        const submenu = document.getElementById(submenuId);
        const arrow = document.getElementById(arrowId);
        
        if (submenu && arrow) {
            submenu.classList.toggle("hidden");
            arrow.classList.toggle("rotate-180");
            
            // Add smooth animation
            if (!submenu.classList.contains("hidden")) {
                submenu.style.opacity = "0";
                submenu.style.transform = "translateY(-8px)";
                
                requestAnimationFrame(() => {
                    submenu.style.transition = "all 0.3s cubic-bezier(0.4, 0, 0.2, 1)";
                    submenu.style.opacity = "1";
                    submenu.style.transform = "translateY(0)";
                });
            }
        }
    };

    // Auto-open submenu if current URL matches a child link
    const currentUrl = window.location.href;
    document.querySelectorAll("div[id$='Submenu']").forEach(submenu => {
        const links = submenu.querySelectorAll("a");
        links.forEach(link => {
            if (currentUrl.includes(link.getAttribute("href"))) {
                submenu.classList.remove("hidden");
                const arrowId = submenu.id.replace("Submenu", "Arrow");
                const arrow = document.getElementById(arrowId);
                if (arrow) arrow.classList.add("rotate-180");
            }
        });
    });

    // Enhanced hover effects for menu items
    document.querySelectorAll('.sidebar-menu-item a, .sidebar-menu-item button').forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.transform = 'translateX(4px)';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.transform = 'translateX(0)';
        });
    });

    // Mobile sidebar close functionality
    const sidebarClose = document.getElementById('sidebarClose');
    if (sidebarClose) {
        sidebarClose.addEventListener('click', function() {
            // You can add mobile sidebar hide logic here
            console.log('Sidebar close clicked');
        });
    }

    // Loading states for navigation links
    document.querySelectorAll('a[href]:not([href="#"]):not([href^="javascript:"])').forEach(link => {
        link.addEventListener('click', function() {
            const icon = this.querySelector('svg');
            if (icon && !this.href.includes('#')) {
                icon.classList.add('animate-spin');
                setTimeout(() => {
                    if (icon) icon.classList.remove('animate-spin');
                }, 1000);
            }
        });
    });

    // Dynamic stats update (demo functionality)
    function updateStats() {
        const projectStat = document.querySelector('.text-blue-600.font-bold');
        const budgetStat = document.querySelector('.text-green-600.font-bold');
        
        if (projectStat && budgetStat) {
            // Simulate real-time updates
            const currentProjects = parseInt(projectStat.textContent) || 12;
            const variation = Math.floor(Math.random() * 3) - 1; // -1, 0, or 1
            const newCount = Math.max(1, currentProjects + variation);
            
            projectStat.textContent = newCount;
            
            // Update budget with some variation
            const budget = (2.4 + (Math.random() - 0.5) * 0.4).toFixed(1);
            budgetStat.textContent = `â‚±${budget}M`;
        }
    }

    // Update stats every 30 seconds
    setInterval(updateStats, 30000);
});
</script>
<style>
#notifDropdown:not(.hidden) {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}
</style>

<script src="/static/js/notifications.js"></script>